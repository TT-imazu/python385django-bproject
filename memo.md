# 資金繰システム開発bproject

## multibank機能の前面刷新
各銀行を横に並べて比較する機能だが、すべて変更したい。

## 表示方法について
表示方法はaddbudgetの予算表示が各銀行が横に並んだものとする。

## データの取得方法について
addbudgetのデータ取得方法を参考にmultibankのデータ取得方法を考えていきたい。

### addbudgetでのデータ取得方法
   date_ranges = DateRange.objects.all()
   for dr in date_ranges:
      for item_type in ['insales', 'inregular', 'auto', 'individual','fundtrans']:
            prefix = f"{dr.id}_{item_type}_new"

            item_name_key = f'item_name_{prefix}'
            amount_key = f'amount_{prefix}'
            sort_no1_key = f'sort_no1_{prefix}'
            sort_no2_key = f'sort_no2_{prefix}'
            itemtype_key = f'itemtype_{prefix}'
            daterange_key = f'daterange_{prefix}'
            yearmonth_key = f'year_month_{prefix}'

            if item_name_key in request.POST:
               item_name = request.POST.get(item_name_key, '')
               amount_str = request.POST.get(amount_key, '0')
               sort_no1_str = request.POST.get(sort_no1_key, '0')
               sort_no2_str = request.POST.get(sort_no2_key, '0')
               itemtype_str = request.POST.get(itemtype_key, '工事金入金')
               daterange_id = request.POST.get(daterange_key)
               post_year_month = request.POST.get(yearmonth_key, user_settings.year_month)

## multibankの表示とaddbugetのデータ取得
### datarangeごとにすべての銀行は一つのテーブルとなる。

-----------------------------
|  |bank1|bank2|bank3|bank4|
-----------------------------
|  |     |     |     |     |
-----------------------------



### テーブルの構造
1. 各datarangeごとに1つのテーブルを作成
2. 各銀行の列は上から下までつながっている（セル結合なし）
3. 各行の高さは内容に応じて自動調整
4. 各銀行ごとにデータの数が違うので、最大値に合わせてテーブルを作成
5. データがないtdはブランクが入る
6. 合計金額の行は揃える

### 表示の条件
1. 大分類と小分類は通常通り表示
2. 詳細は原則表示しない
3. 連結されていない入金のみ、詳細を1行で表示
4. 詳細表示はtdの中にtableを作らず、1行で表示する

### アコーディオンや色の使いかた等
addbudgetと同じとする。

# 複数銀行予算比較の表示構造

## 1. 基本構造
- 1つのテーブルで複数銀行のデータを横並びで表示
- 各行は各銀行のデータを表示
- アコーディオン機能で大項目の開閉が可能

## 2. 表示項目の階層構造

```
収入（アコーディオン）
├── 工事金入金（連結済）合計
├── 〇〇工事代金（詳細行）
├── △△工事代金（詳細行）
└── その他入金合計

支出（アコーディオン）
├── 自動引落
└── 個別支払

振替（アコーディオン）
├── 振替（連結済）合計
├── 銀行A→銀行B（詳細行）
└── 銀行B→銀行C（詳細行）
```

## 3. 各項目の説明

### 3.1 収入
- 収入全体はアコーディオンで開閉可能
- 工事金入金は連結済の合計と詳細行を表示
  - 連結済合計：各銀行の合計金額
  - 詳細行：各工事代金の明細（未連結のものも含む）
- その他入金は合計のみ表示

### 3.2 支出
- 支出全体はアコーディオンで開閉可能
- 自動引落と個別支払は合計金額のみ表示

### 3.3 振替
- 振替全体はアコーディオンで開閉可能
- 連結済の合計と各振替の詳細を表示
  - 連結済合計：各銀行間の振替合計
  - 詳細行：各銀行間の振替明細

## 4. 表示ルール

1. アコーディオン機能
   - 収入、支出、振替の大項目はアコーディオンで開閉可能
   - 初期状態は折りたたまれている
   - クリックで展開/折りたたみ可能

2. 詳細行の表示
   - 工事金入金と振替のみ詳細行を表示
   - 詳細行は背景色を変えて区別
   - 未連結の明細も含めて表示

3. 合計行の表示
   - 各項目の合計は太字で表示
   - 残高見込は黄色背景で強調表示

4. データの配置
   - 各銀行のデータは横並びで表示
   - 空のデータは「-」で表示
   - 金額は右揃えで表示

## 5. テーブル構造の例

| 項目 | 銀行A | 銀行B | 銀行C |
|------|-------|-------|-------|
| 収入（合計） | 500,000 | 300,000 | 400,000 |
| 工事金入金（連結済）合計 | 200,000 | 200,000 | 150,000 |
| 〇〇工事代金 | 200,000 | - | - |
| △△工事代金 | - | - | 150,000 |
| その他入金合計 | 100,000 | 100,000 | 100,000 |
| 支出（合計） | 300,000 | 200,000 | 250,000 |
| 自動引落 | 200,000 | 150,000 | 200,000 |
| 個別支払 | 100,000 | 50,000 | 50,000 |
| 振替（合計） | 0 | 0 | 0 |
| 振替（連結済）合計 | 0 | 0 | 0 |
| 銀行A→銀行B | - | - | - |
| 銀行B→銀行C | - | - | - |
| 残高見込 | 1,200,000 | 2,100,000 | 3,150,000 |

# マルチバンク機能の今後の実装予定

## 1. 取引管理機能
- 取引の追加機能
- 取引の編集機能
- 取引の削除機能
- 取引の一括登録機能（CSVインポート）

## 2. 口座管理機能
- 口座の追加機能
- 口座の編集機能
- 口座の削除機能
- 口座の並び替え機能

## 3. 検索・フィルタリング機能
- 取引の検索機能（日付、金額、摘要など）
- 取引のフィルタリング機能（入金/出金、金額範囲など）
- 検索条件の保存機能

## 4. 分析・可視化機能
- 残高推移のグラフ表示
- 月次収支の分析
- カテゴリー別の支出分析
- 予算との比較分析

## 5. その他の機能
- データのエクスポート機能（CSV、PDF）
- 複数口座間の振替機能
- 定期的な取引の自動登録機能
- モバイル対応のレスポンシブデザイン

